.. |date| date:: %Y-%m-%d

:title: Ansible
:date: 2017-01-30
:modified: |date|
:author: Artur K.
:category: Administration
:tags: ansible, python, linux
:slug: ansible

.. figure:: /images/ansible-header.jpg
    :height: 373px
    :width: 768px
    :scale: 65%
    :align: center
    :alt: Ansible

Официальная документация по `Ansible <http://docs.ansible.com/ansible/index.html>`_

**Ansible** - система управления конфигурациями, написанная на Python, с
использованием декларативного языка разметки для описания конфигураций.
Используется для автоматизации настройки и развертывания программного обеспечения.

**Ansible** - берет на себя всю работу по приведению удаленных серверов в
необходимое состояние. Администратору необходимо лишь описать, как достичь
этого состояния с помощью так называемых сценариев (playbooks; это аналог
рецептов Chef). Такая технология позволяет очень быстро осуществлять
переконфигурирования системы: достаточно всего лишь добавить несколько новых
строк в сценарий.

Преимущества **Ansible** по сравнению с другими аналогичными решениями (*Pupprt*,
*Chef* и *Salt*) заключается в следующем:

- на управляемые узлы не нужно устанавливать никакого дополнительного ПО, всё работает через SSH (в случае необходимости дополнительные модули можно взять из официального репозитория);
- код программы, написанный на Python, очень прост; при необходимости написание дополнительных модулей не составляет особого труда;
- язык, на котором пишутся сценарии, также предельно прост;
- низкий порог вхождения: обучиться работе с Ansible можно за очень короткое время;
- документация к продукту написана очень подробно и вместе с тем — просто и понятно; она регулярно обновляется;
- Ansible работает не только в режиме push, но и pull, как это делают большинство систем управления (Puppet, Chef);
- имеется возможность последовательного обновления состояния узлов (rolling update).

=========
Установка
=========

Требования для установки **Ansible** минимальны. На машине с которой
производится управления должен быть установлен Python 2.6 или выше. На
управляемых узлах должен быть установлен только Python версии не ниже 2.4, но
он, как правило, по умолчанию включен в состав большинства дистрибутивов
linux-систем.

Так же могут потребоваться следующие модули Python, устанавливаемые через pip
или пакетный менеджер вашей операционной системы:

- paramiko;
- PyYAML;
- jinja2.

В Ubuntu установка самого **Ansible** и зависимостей осуществляется добавлением репозитория и установкой пакета:

.. code::

    sudo add-apt-repository -y ppa:rquillo/ansible
    sudo apt-get update
    sudo apt-get install ansible -y

===============
Группы серверов
===============

Список групп серверов, которыми можно управлять, Ansible может получать двумя основными способами:

- из специального текстового файла;
- с помощью внешнего скрипта, возвращающего нужный нам список серверов, например из MongoDB.

==========
Файл hosts
==========

Дефолтное расположение файла - **/etc/ansible/hosts**, но оно может также быть
задано параметром окружения $ANSIBLE_HOSTS или параметром -i при запуске ansible
и ansible-playbook. Содержимое этого файла может выглядеть, например, так (в
квадратных скобках указаны имена групп управляемых узлов, ниже перечисляются
входящие в эти группы серверы):

.. code::

    [dbservers]
    one.example.com
    two.example.com
    three.example.com

    [dnsservers]
    rs1.example.com ansible_ssh_port=1234 ansible_ssh_host=192.168.1.10
    rs2.example.com
    ns[01:50].example.com

Помимо списка управляемых узлов, в файле hosts могут быть указаны и другие
сведенияб необходимые для работы: номера портов для подключения по SSH, способ
подключения, пароль для подключения по SSH, имя пользователя, объединения групп
и т.п.

==============
Модули Ansible
==============

В состав Ansible входит огромное количество модулей для развёртывания,
контроля и управления различными компонентами, которые можно условно разделить
на следующие группы (в скобках приведены названия некоторых продуктов и
сервисов):

облачные ресурсы и виртуализация (Openstack, libvirt);
базы данных (MySQL, Postgresql, Redis, Riak);
файлы (шаблонизация, регулярные выражения, права доступа);
мониторинг (Nagios, monit);
оповещения о ходе выполнения сценария (Jabber, Irc, почта, MQTT, Hipchat);
сеть и сетевая инфраструктура (Openstack, Arista);
управление пакетами (apt, yum, rhn-channel, npm, pacman, pip, gem);
система (LVM, Selinux, ZFS, cron, файловые системы, сервисы, модули ядра);
работа с различными утилитами (git, hg).

Список источников:

- `Система управления Ansible <https://habrahabr.ru/company/selectel/blog/196620/>`_
- `Ansible - давайте попробуем <https://habrahabr.ru/company/express42/blog/254959/>`_
