:title: Ansible Introduction. Part 3
:date: 2017-02-21
:modified: 2017-02-21
:author: Artur K.
:category: Administration
:tags: ansible, python, linux
:slug: ansible_end
:status: draft

.. contents:: **Содержание**
   :depth: 3

----

========
**Роли**
========

Ролью называется типовой набор переменных и задач, назначаемых для одного или
нескольких серверов. Если вам нужно применить к серверу или группе серверов
типовой набор операций, вам достаточно просто назначить ему роль. Предварительно
в проекте каталоге проекта должна быть создана соответствующая структура. В
сценариях роли назначаются следующим образом:

.. code::

    ---
    - name: check and apply basic configuration to all hosts
      hosts: all
      roles:
        - common

    - name: check and apply configuration to group1
      hosts: group1
      roles:
        - pgsql

    - name: check and apply configuration to group2
      hosts: group2
      roles:
        - fooapp

=====================
**Структура проекта**
=====================

.. code::

    ├── production                # инвентарный файл для продакшн-серверов
    ├── stage                     # инвентарный файл для stage-окружения
    │
    ├── group_vars/
    │   ├── group1                # здесь назначаются переменные для
    │   └── group2                # конкретных групп
    ├── host_vars/
    │   ├── hostname1             # специфические переменные для хостов в
    │   └── hostname2             # случае необходимости прописываются здесь
    │
    ├── site.yml                  # основной сценарий
    ├── webservers.yml            # сценарий для веб-сервера
    ├── dbservers.yml             # сценарий для сервера базы данных
    │
    └── roles/
    ├── common/               # здесь описываются роли
    │   ├── tasks/            #
    │   │   └── main.yml      # - файл задач роли, может включать файлы
    │   │                     #   меньшего размера
    │   ├── handlers/         #
    │   │   └── main.yml      # - файл с обработчиками (handlers)
    │   ├── templates/        # - директория для шаблонов, в данном
    │   │   └── ntp.conf.j2   #   случае - для конфига ntp
    │   ├── files/            #
    │   │   ├── bar.txt       # - файл-ресурс для копирования на хост
    │   │   └── foo.sh        # - скрипт для выполнения на удалённом хосте
    │   └── vars/             #
    │       └── main.yml      # - ассоциированные с ролью переменные
    │
    ├── pgsql/                # такая же структура, как выше, для роли pgsql
    └── fooapp/               # такая же структура, как выше, для роли fooapp

==============
Модули Ansible
==============

Модуль можно написать на любом языке, он должен уметь принимать параметры на
вход и выдавать json ответ. Модули находятся `здесь <http://docs.ansible.com/ansible/list_of_all_modules.html>`_.

Как написать свой собственный модуль, можно прочитать в `документации <http://docs.ansible.com/ansible/dev_guide/developing_modules.html>`_.

В состав Ansible входит огромное количество модулей для развёртывания,
контроля и управления различными компонентами, которые можно условно разделить
на следующие группы (в скобках приведены названия некоторых продуктов и
сервисов):

- облачные ресурсы и виртуализация (Openstack, libvirt);
- базы данных (MySQL, Postgresql, Redis, Riak);
- файлы (шаблонизация, регулярные выражения, права доступа);
- мониторинг (Nagios, monit);
- оповещения о ходе выполнения сценария (Jabber, Irc, почта, MQTT, Hipchat);
- сеть и сетевая инфраструктура (Openstack, Arista);
- управление пакетами (apt, yum, rhn-channel, npm, pacman, pip, gem);
- система (LVM, Selinux, ZFS, cron, файловые системы, сервисы, модули ядра);
- работа с различными утилитами (git, hg).
